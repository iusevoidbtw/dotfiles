#!/bin/sh

if [ "$(id -u)" != 0 ]; then
	echo "this script must be ran as root"
	exit 1
fi

echo "removing orphan packages..."
xbps-remove -Ooy

echo "removing package cache..."
# TODO: fix very inefficient package cache removal
for x in /var/cache/xbps/*.xbps; do
	xbps-query $(xbps-uhelper binpkgver "$x") 1>/dev/null 2>&1
	if [ $? -eq 2 ]; then
		rm -v "$x" "$x.sig2"
	fi
done
